#!/bin/bash

TAB=$'\t'
IFS=''

explode()
{
	local separator=$1
	local string=$2
	local new_string
	EXPLODE_ARRAY=()
	
	while [ -n "$string" ]
	do
		EXPLODE_ARRAY+=("${string%%$separator*}")
		new_string=${string#*$separator}
		if [ "$string" = "$new_string" ]
		then
			break
		fi
		string=$new_string
	done
	
	# return $EXPLODE_ARRAY
}


# compute width of each column

column_width=()
text=''
while read -r line
do
	text="$text${text:+$'\n'}$line"
	explode $'\t' "$line"
	
	column=0
	for cell in "${EXPLODE_ARRAY[@]}"
	do
		width=${#cell}
		if [ -z "${column_width[$column]}" ] || [ $width -gt "${column_width[$column]}" ]
		then
			column_width[$column]=$width
		fi
		let column++
	done
done


# compose the format string

fmt=''
segments=()
for column in "${!column_width[@]}"
do
	fmt="$fmt|%${column_width[$column]}s"
	segments+=('')
done
fmt="$fmt|"

vborder=`printf -- "$fmt\n" "${segments[@]}" | tr "| " "+-"`



# print the table

while read -r line
do
	explode $'\t' "$line"
	
	echo "$vborder"
	printf -- "$fmt\n" "${EXPLODE_ARRAY[@]}"
done <<<"$text"
echo "$vborder"
