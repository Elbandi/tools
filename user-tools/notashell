#!/usr/bin/env perl

if(not $ENV{'NOTASHELL_REDIRECT'})
{
	my $basename = $0 =~ s/.*\/([^\/]+)$/$1/r;
	$progname = $basename;
	exec {"/var/lib/notashell/real-" . $basename} $basename, @ARGV;
}
else
{
	if(scalar @ARGV != 2 or $ARGV[0] != '-c')
	{
		die "notashell: Supposed to be called as 'notashell -c CommandString'\n";
	}
	
	$CommandString = $ARGV[1];
	@cmd_args = split / /, $CommandString;
	$progname = $cmd_args[0];
	$ENV{'NOTASHELL_REDIRECT'} = 0;
	
	exec {$cmd_args[0]} @cmd_args;
}

($errno, $errstr) = (int $!, $!);
warn "$progname: $errstr\n";
exit 125+$errno;
